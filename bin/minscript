#!/usr/bin/env coffee

vm      = require 'vm'
fs      = require 'fs'
util    = require 'util'
prompt  = require 'prompt'

parser  = require '../lib/parser'
emitter = require '../lib/emitter'
wrapper = require '../lib/wrapper'

replEmitter = emitter.init()
ctx = vm.createContext()
ctx['console'] = console;

compile = ->
  #

repl = ->
  prompt.get ['repl'], (err, result)->
    ast = parser.parse(result.repl)
    console.log ast
    js = replEmitter.emit(ast).join(";")
    console.log js
    console.log "=>", vm.runInContext(js, ctx)
    repl()

switch process.argv[2]
  when 'repl'
    repl()
  else
    repl()
